!function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(r,o,function(t){return e[t]}.bind(null,o));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=23)}([function(e,t){e.exports=React},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t._=void 0,t._=function(e){return e}},function(e,t){e.exports=ReactRedux},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.epics=t.actions=t.serializeRequest=void 0;var r=n(7),o=n(8),i=n(16),a=n(17),s=[],c=function(e,t){var n=r.createAsyncAction("api/"+e,"api/"+e+"_success","api/"+e+"_failure")();return s.push(function(e,o,s){return e.pipe(i.filter(function(e){return r.isActionOf(n.request)(e)}),i.mergeMap(function(e){return a.from(t(e.payload,s)).pipe(i.map(function(t){return n.success([e.payload,t])}),i.catchError(function(t){return a.of(n.failure([e.payload,t]))}))}))}),n};t.serializeRequest=function(e){return void 0===e?"":JSON.stringify(e,Object.keys(e).sort())},t.actions={getConfiguration:c("getConfiguration",function(e,t){return t.wordPressAPIClient.getConfiguration()}),updateConfiguration:c("updateConfiguration",function(e,t){return t.wordPressAPIClient.updateConfiguration(e)}),setAccessToken:c("setAccessToken",function(e,t){return t.wordPressAPIClient.setAccessToken(e)})},t.epics=o.combineEpics.apply(void 0,s)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.epics=t.actions=t.serializeRequest=void 0;var r=n(7),o=n(8),i=n(16),a=n(17),s=[],c=function(e,t){var n=r.createAsyncAction("management-api/"+e,"management-api/"+e+"_success","management-api/"+e+"_failure")();return s.push(function(e,o,s){return e.pipe(i.filter(function(e){return r.isActionOf(n.request)(e)}),i.mergeMap(function(e){return a.from(t(e.payload,s)).pipe(i.map(function(t){return n.success([e.payload,t])}),i.catchError(function(t){return a.of(n.failure([e.payload,t]))}))}))}),n};t.serializeRequest=function(e){return void 0===e?"":JSON.stringify(e,Object.keys(e).sort())},t.actions={getApplicationById:c("getApplicationById",function(e,t){return t.managementAPIClient.getApplicationById(e)}),getSegmentList:c("getSegmentList",function(e,t){return t.managementAPIClient.getSegmentList(e)}),getStats:c("getStats",function(e,t){return t.managementAPIClient.stats(e)})},t.epics=o.combineEpics.apply(void 0,s)},function(e,t,n){"use strict";var r=this&&this.__assign||function(){return(r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0}),t.stateHelper=t.serializeStatsRequest=void 0;var o=n(7),i=n(4),a=n(29),s=n(6),c={application:r({},{byId:{}}),segment:r({},r(r({},{byId:{}}),{listByApplicationId:{}})),stats:{},network:{loading:{},success:{},failure:{}}},l=/^management-api\/(.+)_(success|failure)$/,u=/^management-api\/(((?!_success)(?!_failure).)+)$/,p=function(e,t){return{getById:function(n){return t[e].byId[n]}}},d=function(e,t){var n=p(e,t);return r(r({},n),{listByApplicationId:function(r){var o=t[e].listByApplicationId[r];if(o)return o.map(function(e){return n.getById(e)}).filter(function(e){return!!e})}})},f=function(e){var t=o.getType(e),n=u.exec(t);if(n)return n[1]};t.serializeStatsRequest=function(e){return s.stringify(e,{sort:function(e,t){return e.localeCompare(t)}})},t.stateHelper=function(e){return{application:p("application",e),segment:d("segment",e),stats:function(n){return e.stats[t.serializeStatsRequest(n)]},network:{latest:{loading:function(t){var n=f(t);return!!n&&(!!e.network.loading[n]&&e.network.loading[n].latest)},success:function(t){var n=f(t);return!!n&&(!!e.network.success[n]&&e.network.success[n].latest)},failure:function(t){var n=f(t);if(n&&e.network.failure[n])return e.network.failure[n].latest}},loading:function(t,n){var r=f(t);return!!r&&(!!e.network.loading[r]&&e.network.loading[r].requests.has(i.serializeRequest(n)))},success:function(t,n){var r=f(t);return!!r&&(!!e.network.success[r]&&e.network.success[r].requests.has(i.serializeRequest(n)))},failure:function(t,n){var r=f(t);if(r&&e.network.failure[r])return e.network.failure[r].requests[i.serializeRequest(n)]}}}},t.default=function(e,n){var s;void 0===e&&(e=c);var p=void 0,d=u.exec(n.type);if(d){var f=d[1];(_=(h=(p||e).network).loading[f]||{requests:new Set,latest:!1}).requests.add(i.serializeRequest(n.payload)),_.latest=!0,h.loading[f]=_,h.success[f]&&(h.success[f].latest=!1),h.failure[f]&&(h.failure[f].latest=void 0),p=r(r({},p||e),{network:h})}if(d=l.exec(n.type)){f=d[1];var h,m=d[2],g=n.payload[0],b=i.serializeRequest(g),v=(h=(p||e).network).loading[f];if(v&&(v.requests.delete(b),v.latest=!1),"success"===m)(_=h.success[f]||{requests:new Set,latest:!1}).requests.add(b),_.latest=!0,h.success[f]=_;if("failure"===m){var y=n.payload[1],_=h.failure[f]||{requests:{},latest:void 0},P=new a.ManagementAPIError(y);_.requests[b]=P,_.latest=P,h.failure[f]=_}p=r(r({},p||e),{network:h})}var w=function(t,n,o){for(var i,a=(p||e)[t],s=a.byId,c=0,l=o.list;c<l.length;c++){var u=l[c];s[u.id]=u}p=r(r({},p||e),((i={})[t]=a,i))};switch(n.type){case o.getType(i.actions.getApplicationById.success):var E=n.payload,C=(g=E[0],E[1]);w("application",0,{list:[C]});break;case o.getType(i.actions.getStats.success):var k=n.payload;g=k[0],C=k[1];p=r(r({},e),{stats:r(r({},e.stats),(s={},s[t.serializeStatsRequest(g)]=C,s))});break;case o.getType(i.actions.getSegmentList.success):var T=n.payload;!function(t,n,o){var i;w(t,0,o);var a=(p||e)[t];a.listByApplicationId[n.applicationId]=o.list.map(function(e){return e.id}).filter(function(e){return!!e}),p=r(r({},p||e),((i={})[t]=a,i))}("segment",g=T[0],C=T[1])}return p||e}},function(e,t){e.exports=qs},function(e,t){e.exports=TypesafeActions},function(e,t){e.exports=ReduxObservable},function(e,t,n){"use strict";var r=this&&this.__assign||function(){return(r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0}),t.stateHelper=void 0;var o=n(7),i=n(3),a=n(28),s={network:{loading:{},success:{},failure:{}}},c=/^api\/(.+)_(success|failure)$/,l=/^api\/(((?!_success)(?!_failure).)+)$/,u=function(e){var t=o.getType(e),n=l.exec(t);if(n)return n[1]};t.stateHelper=function(e){return{network:{latest:{loading:function(t){var n=u(t);return!!n&&(!!e.network.loading[n]&&e.network.loading[n].latest)},success:function(t){var n=u(t);return!!n&&(!!e.network.success[n]&&e.network.success[n].latest)},failure:function(t){var n=u(t);if(n&&e.network.failure[n])return e.network.failure[n].latest}},loading:function(t,n){var r=u(t);return!!r&&(!!e.network.loading[r]&&e.network.loading[r].requests.has(i.serializeRequest(n)))},success:function(t,n){var r=u(t);return!!r&&(!!e.network.success[r]&&e.network.success[r].requests.has(i.serializeRequest(n)))},failure:function(t,n){var r=u(t);if(r&&e.network.failure[r])return e.network.failure[r].requests[i.serializeRequest(n)]}}}},t.default=function(e,t){void 0===e&&(e=s);var n=void 0,u=l.exec(t.type);if(u){var p=u[1];(v=(d=(n||e).network).loading[p]||{requests:new Set,latest:!1}).requests.add(i.serializeRequest(t.payload)),v.latest=!0,d.loading[p]=v,d.success[p]&&(d.success[p].latest=!1),d.failure[p]&&(d.failure[p].latest=void 0),n=r(r({},n||e),{network:d})}if(u=c.exec(t.type)){p=u[1];var d,f=u[2],h=t.payload[0],m=i.serializeRequest(h),g=(d=(n||e).network).loading[p];if(g&&(g.requests.delete(m),g.latest=!1),"success"===f)(v=d.success[p]||{requests:new Set,latest:!1}).requests.add(m),v.latest=!0,d.success[p]=v;if("failure"===f){var b=t.payload[1],v=d.failure[p]||{requests:{},latest:void 0},y=new a.WordPressAPIError(b);v.requests[m]=y,v.latest=y,d.failure[p]=v}n=r(r({},n||e),{network:d})}switch(t.type){case o.getType(i.actions.updateConfiguration.success):case o.getType(i.actions.setAccessToken.success):var _=t.payload,P=(h=_[0],_[1]);n=r(r({},n||e),{configuration:P});break;case o.getType(i.actions.getConfiguration.success):var w=t.payload;h=w[0],P=w[1];n=r(r({},n||e),{configuration:P})}return n||e}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Constants=void 0,t.Constants={DASHBOARD_URL:"https://dashboard.wonderpush.com/",WONDERPUSH_HOMEPAGE_URL:"https://www.wonderpush.com/",WONDERPUSH_SIGNUP_URL:"https://dashboard.wonderpush.com/account/signup",MANAGEMENT_API_URL:"https://management-api.wonderpush.com/v1/"}},function(e,t,n){"use strict";var r=this&&this.__decorate||function(e,t,n,r){var o,i=arguments.length,a=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},o=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0}),t.StatsResponse=t.WordPressWonderPushConfiguration=t.Segment=t.Application=t.WebSDKInitOptions=t.WebSDKPluginOptions=t.WebSDKSubscriptionNativeOptions=t.WebSDKOptinOptions=t.WebSDKSubscriptionBellOptions=t.WebSDKSubscriptionDialogOptions=t.WebSDKTriggerOptions=t.Platform=void 0;var i,a=n(12);!function(e){e.WEB="Web",e.ANDROID="Android",e.IOS="iOS"}(i=t.Platform||(t.Platform={}));var s=function(){return function(){}}();t.WebSDKTriggerOptions=s;var c=function(){function e(){}return r([a.Type(function(){return s}),o("design:type",s)],e.prototype,"triggers",void 0),e}();t.WebSDKSubscriptionDialogOptions=c;var l=function(){return function(){}}();t.WebSDKSubscriptionBellOptions=l;var u=function(){return function(){}}();t.WebSDKOptinOptions=u;var p=function(){function e(){}return r([a.Type(function(){return s}),o("design:type",s)],e.prototype,"triggers",void 0),e}();t.WebSDKSubscriptionNativeOptions=p;var d=function(){return function(){}}();t.WebSDKPluginOptions=d;var f=function(){function e(){}return e.prototype.isPromptTypeActive=function(e){switch(e){case"bell":return!!this.subscriptionBell;case"dialog":return!(!this.subscriptionDialog||!this.subscriptionDialog.triggers||this.subscriptionDialog.triggers.manual);case"native":return!(!this.subscriptionNative||!this.subscriptionNative.triggers||this.subscriptionNative.triggers.manual);case"cross-domain":return void 0===this.allowedSubscriptionDomains||!!this.allowedSubscriptionDomains.length}},r([a.Type(function(){return p}),o("design:type",p)],e.prototype,"subscriptionNative",void 0),r([a.Type(function(){return c}),o("design:type",c)],e.prototype,"subscriptionDialog",void 0),r([a.Type(function(){return l}),o("design:type",l)],e.prototype,"subscriptionBell",void 0),r([a.Type(function(){return u}),o("design:type",u)],e.prototype,"optInOptions",void 0),r([a.Type(function(){return d}),o("design:type",d)],e.prototype,"plugins",void 0),e}();t.WebSDKInitOptions=f;var h=function(){function e(){}return e.prototype.hasPlatform=function(e){return!!this.platforms&&this.platforms.indexOf(e)>=0},Object.defineProperty(e.prototype,"webPlatformConfigured",{get:function(){return!!this.platforms&&this.platforms.indexOf(i.WEB)>=0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"apnsCertificateIsUniversal",{get:function(){return!!this.apnsCertificate&&!!this.apnsCertificate.keyName&&this.apnsCertificate.keyName.startsWith("Apple Push Services:")},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"dashboardUrl",{get:function(){return new URL("https://dashboard.wonderpush.com/applications/"+this.id+"/overview?utm_source=WordPressPlugin")},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"supportUrl",{get:function(){return new URL("https://dashboard.wonderpush.com/applications/"+this.id+"/overview?intercom&utm_source=WordPressPlugin")},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"dashboardCampaignsUrl",{get:function(){return new URL("https://dashboard.wonderpush.com/applications/"+this.id+"/campaigns/view?utm_source=WordPressPlugin")},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"dashboardInAppsUrl",{get:function(){return new URL("https://dashboard.wonderpush.com/applications/"+this.id+"/inapp-campaigns/view?utm_source=WordPressPlugin")},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"dashboardSegmentsUrl",{get:function(){return new URL("https://dashboard.wonderpush.com/applications/"+this.id+"/segments/view?utm_source=WordPressPlugin")},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"dashboardWebSettingsUrl",{get:function(){return new URL("https://dashboard.wonderpush.com/applications/"+this.id+"/web-settings?utm_source=WordPressPlugin")},enumerable:!1,configurable:!0}),r([a.Type(function(){return f}),o("design:type",f)],e.prototype,"webSdkInitOptions",void 0),e}();t.Application=h;var m=function(){return function(){}}();t.Segment=m;var g=function(){return function(){}}();t.WordPressWonderPushConfiguration=g;var b=function(){function e(){}return e.prototype.totalSent=function(e){return void 0===e&&(e=void 0),this.total("@NOTIFICATION_SENT",e)},e.prototype.totalOpened=function(e){return void 0===e&&(e=void 0),this.total("@NOTIFICATION_OPENED",e)},e.prototype.total=function(e,t){return void 0===t&&(t=void 0),this.data.reduce(function(n,r){return n+r.counters.reduce(function(n,r){return r.platform===t&&r.type===e?n+r.count:n},0)},0)},e}();t.StatsResponse=b},function(e,t){e.exports=ClassTransformer},function(e,t){e.exports=window},function(e,t,n){"use strict";var r;Object.defineProperty(t,"__esModule",{value:!0}),t.getConfig=void 0,t.getConfig=function(){var e=function(){return window.WonderPushWordPress?Promise.resolve(window.WonderPushWordPress):Promise.reject(new Error("Missing WonderPush Wordpress configuration"))};return"complete"===document.readyState||"loaded"===document.readyState?e():(r||(r=new Promise(function(t,n){window.addEventListener("DOMContentLoaded",function(){e().then(t).catch(n)})})),r)}},function(e,t,n){"use strict";var r,o=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0}),t.AccessTokenForm=void 0;var i=n(0),a=n(0),s=n(2),c=n(3),l=n(9),u=n(1),p=n(13),d=n(10),f=function(e){function t(t){var n=e.call(this,t)||this;return n.state={accessToken:t.configuration?t.configuration.accessToken:void 0},t.configuration||t.fetchingConfiguration||t.fetchConfiguration(),n}return o(t,e),t.prototype.componentDidUpdate=function(e,t){this.props.configuration&&this.props.configuration!==e.configuration&&!this.props.fetchingConfiguration&&this.setState({accessToken:this.props.configuration.accessToken})},t.prototype.save=function(){this.state.accessToken&&this.props.updateAccessToken(this.state.accessToken)},t.prototype.renderError=function(){var e=this.props.updateAccessTokenFailure;return e?e.response&&400===e.response.status?a.createElement("div",{className:"error"},u._("Invalid access token")):a.createElement("div",{className:"error"},e.response&&e.response.data&&e.response.data.error&&e.response.data.error.message?a.createElement("span",null,u._("An error occurred: "),a.createElement("code",null,e.response.data.error.message)):u._("An unknown error occurred, please try again.")):null},t.prototype.render=function(){var e=this,t=this.state.accessToken,n=this.props.updatingAccessToken;return a.createElement("div",{className:"access-token-form"},this.renderError(),a.createElement("input",{type:"text",value:t||"",onChange:function(t){return e.setState({accessToken:t.target.value})}}),a.createElement("button",{className:"button button-primary",disabled:n||!t,onClick:function(){return e.save()}},n?a.createElement("span",{className:"dashicons dashicons-update spin"}):null,u._("Save")),a.createElement("div",null,a.createElement("small",{dangerouslySetInnerHTML:{__html:p.sprintf(u._("You'll find it in %syour dashboard%s under <em>Settings / API credentials</em>."),'<a target="_blank" href="'+d.Constants.DASHBOARD_URL+'?utm_source=WordPressPlugin&utm_content=get_credentials">',"</a>")}})))},t}(i.Component);t.AccessTokenForm=s.connect(function(e,t){var n=l.stateHelper(e.wordPressAPI);return{configuration:e.wordPressAPI.configuration,fetchingConfiguration:n.network.latest.loading(c.actions.getConfiguration.request),updatingAccessToken:n.network.latest.loading(c.actions.setAccessToken.request),updateAccessTokenSuccess:n.network.latest.success(c.actions.setAccessToken.request),updateAccessTokenFailure:n.network.latest.failure(c.actions.setAccessToken.request)}},function(e,t){return{fetchConfiguration:function(){return e(c.actions.getConfiguration.request({}))},updateAccessToken:function(t){return e(c.actions.setAccessToken.request({accessToken:t}))}}})(f)},function(e,t){e.exports=rxjs.operators},function(e,t){e.exports=rxjs},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getPrefillQueryParams=void 0;var r=n(14),o=n(11);t.getPrefillQueryParams=function(){return r.getConfig().then(function(e){var t={prefill_platforms:o.Platform.WEB,prefill_appName:e.siteName,prefill_siteUrl:e.siteUrl,prefill_webIntegrationType:"WordPress"},n=e.wordPressUrl,r=e.siteName;if(n&&r&&0!==n.indexOf("https://")){var i=r.replace(/[^a-zA-Z0-9]/g,"").toLowerCase();i&&(t.prefill_byWonderPushDomain=i)}return t})}},function(e,t){e.exports=Redux},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.wordPressAPIEpics=t.wordPressAPIActions=void 0;var r=n(9);Object.defineProperty(t,"wordPressAPIReducer",{enumerable:!0,get:function(){return r.default}});var o=n(3);Object.defineProperty(t,"wordPressAPIActions",{enumerable:!0,get:function(){return o.actions}}),Object.defineProperty(t,"wordPressAPIEpics",{enumerable:!0,get:function(){return o.epics}})},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.managementAPIEpics=t.managementAPIActions=void 0;var r=n(5);Object.defineProperty(t,"managementAPIReducer",{enumerable:!0,get:function(){return r.default}});var o=n(4);Object.defineProperty(t,"managementAPIActions",{enumerable:!0,get:function(){return o.actions}}),Object.defineProperty(t,"managementAPIEpics",{enumerable:!0,get:function(){return o.epics}})},function(e,t){e.exports=axios},function(e,t,n){e.exports=n(24)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n(25);var r=n(0),o=n(26),i=n(27),a=n(2),s=n(33);window.WonderPushShowPage=function(e,t){switch(e){case"admin-page":o.render(r.createElement(a.Provider,{store:s.store},r.createElement(i.AdminPage,null)),t)}}},function(e,t){e.exports=Reflect},function(e,t){e.exports=ReactDOM},function(e,t,n){"use strict";var r,o=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0}),t.AdminPage=t.AdminPageComponent=void 0;var i=n(0),a=n(0),s=n(1),c=n(15),l=n(2),u=n(3),p=n(4),d=n(9),f=n(5),h=n(30),m=n(13),g=n(18),b=n(6),v=n(10),y=n(31),_=n(32),P=function(e){function t(t){var n=e.call(this,t)||this;return n.state={},t.configuration||t.fetchingConfiguration||t.fetchConfiguration(),t.configuration&&t.configuration.accessToken&&t.configuration.applicationId&&n.props.fetchApplication({accessToken:t.configuration.accessToken,applicationId:t.configuration.applicationId}),g.getPrefillQueryParams().then(function(e){n.setState({prefillQueryString:b.stringify(e)})}),n}return o(t,e),t.prototype.componentDidUpdate=function(e,t){this.props.configuration&&this.props.configuration.accessToken&&this.props.configuration.applicationId&&this.props.configuration.applicationId!==(e.configuration&&e.configuration.applicationId||void 0)&&!this.props.fetchingApplication&&this.props.fetchApplication({accessToken:this.props.configuration.accessToken,applicationId:this.props.configuration.applicationId})},t.prototype.renderLoading=function(){return a.createElement("div",{className:"wonderpush-admin-page-loader"},a.createElement("span",{className:"dashicons dashicons-update spin"}))},t.prototype.renderSetup=function(){var e=this.state.prefillQueryString;return a.createElement("div",null,a.createElement("p",{className:"p-4",style:{fontSize:"1.1em"}},a.createElement("strong",null,s._("Welcome!"))," ",a.createElement("span",{dangerouslySetInnerHTML:{__html:m.sprintf(s._("You are just a few steps away from sending web push notifications with %sWonderPush%s."),'<a href="'+v.Constants.WONDERPUSH_HOMEPAGE_URL+'?utm_source=WordPressPlugin&utm_content=welcome">',"</a>")}})),a.createElement("div",{className:"row m-md-3"},a.createElement("div",{className:"col-12 col-md-6"},a.createElement("h2",null,s._("Don't have an account?")),a.createElement("a",{className:"button button-primary",target:"_blank",href:v.Constants.WONDERPUSH_SIGNUP_URL+"?"+e+"&utm_source=WordPressPlugin&utm_content=create_account"},s._("Create a WonderPush Account")),a.createElement("p",null,s._("It's free and takes 30 seconds"))),a.createElement("div",{className:"col-12 col-md-6"},a.createElement("h2",null,s._("Enter your Access Token")),a.createElement(c.AccessTokenForm,null))),a.createElement("p",null,a.createElement("strong",null,s._("Looking for help?"))," ",a.createElement("span",{dangerouslySetInnerHTML:{__html:m.sprintf(s._("Head over to our %sQuickstart Guide%s"),'<a target="_blank" href="https://docs.wonderpush.com/docs/wordpress-quickstart">',"</a>")}})))},t.prototype.renderContent=function(){var e=this.props,t=e.application,n=e.configuration,r=e.fetchingApplication;return e.fetchingConfiguration?this.renderLoading():r?this.renderLoading():t||n?n&&!n.accessToken?this.renderSetup():t?a.createElement(h.ConfigurationForm,null):this.renderSetup():this.renderLoading()},t.prototype.render=function(){var e=this.props,t=e.application,n=e.configuration;return a.createElement("div",{className:"wonderpush-admin-page"},a.createElement("header",null,a.createElement("div",{className:"wonderpush-logo"})),a.createElement("div",{className:"container"},a.createElement("div",{className:"row"},a.createElement("div",{className:"col"},a.createElement(y.default,null),t?a.createElement("div",{className:"mb-2 clearfix"},a.createElement("div",{className:"float-right"},a.createElement("a",{href:t.dashboardUrl.href,target:"_blank",className:"button button-primary"},a.createElement("span",{style:{verticalAlign:"middle"},className:"dashicons dashicons-chart-bar"})," ",s._("Analytics"))," ",a.createElement("a",{href:t.dashboardInAppsUrl.href,target:"_blank",className:"button button-primary"},a.createElement("span",{style:{verticalAlign:"middle"},className:"dashicons dashicons-testimonial"})," ",s._("Popups"))," ",a.createElement("a",{href:t.dashboardCampaignsUrl.href,target:"_blank",className:"button button-primary"},a.createElement("span",{style:{verticalAlign:"middle"},className:"dashicons dashicons-bell"})," ",s._("New Notification"))," ",a.createElement("a",{href:t.dashboardSegmentsUrl.href,target:"_blank",className:"button button-primary"},a.createElement("span",{style:{verticalAlign:"middle"},className:"dashicons dashicons-admin-users"})," ",s._("New segment"))," ",a.createElement("a",{href:t.supportUrl.href,target:"_blank",className:"button button-primary"},a.createElement("span",{style:{verticalAlign:"middle"},className:"dashicons dashicons-sos"})," ",s._("Support"))),s._("Need Help? "),a.createElement("a",{target:"_blank",href:t.supportUrl.href},s._("Chat with us")),"."," ",s._("Enjoying WonderPush? "),a.createElement("a",{target:"_blank",href:"http://wordpress.org/support/view/plugin-reviews/wonderpush-web-push-notifications?rate=5#postform"},s._("Give us a 5-star rating")),"!"):null,t&&n&&n.accessToken?a.createElement(_.default,{application:t,accessToken:n.accessToken}):null,a.createElement("div",{className:"wonderpush-admin-page-content"},this.renderContent())))))},t}(i.Component);t.AdminPageComponent=P;t.AdminPage=l.connect(function(e,t){var n=d.stateHelper(e.wordPressAPI),r=f.stateHelper(e.managementAPI);return{configuration:e.wordPressAPI.configuration,fetchingConfiguration:n.network.latest.loading(u.actions.getConfiguration.request),application:e.wordPressAPI.configuration&&e.wordPressAPI.configuration.applicationId?r.application.getById(e.wordPressAPI.configuration.applicationId):void 0,fetchingApplication:r.network.latest.loading(p.actions.getApplicationById.request)}},function(e,t){return{fetchConfiguration:function(){return e(u.actions.getConfiguration.request({}))},fetchApplication:function(t){return e(p.actions.getApplicationById.request(t))}}})(P)},function(e,t,n){"use strict";var r,o=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0}),t.WordPressAPIError=void 0;var i=n(1),a=function(e){function t(n){var r=e.call(this,t.getMessage(t.getErrorData(n)))||this;return r.request=n.request,r.response=n.response,r}return o(t,e),t.getErrorData=function(e){if(e&&e.response&&e.response.data&&e.response.data.error&&("object"==typeof(t=e.response.data.error)&&"number"==typeof t.code&&"string"==typeof t.message))return e.response.data.error;var t},t.getMessage=function(e){var t=e&&e.code||"0",n={0:i._("An error occurred, please try again later.")};return e&&e.message||n[t]||n[0]},t}(Error);t.WordPressAPIError=a},function(e,t,n){"use strict";var r,o=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0}),t.ManagementAPIError=void 0;var i=n(1),a=function(e){function t(n){var r=e.call(this,t.getMessage(t.getErrorData(n)))||this;return r.request=n.request,r.response=n.response,r}return o(t,e),t.getErrorData=function(e){if(e&&e.response&&e.response.data&&e.response.data.error&&("object"==typeof(t=e.response.data.error)&&"string"==typeof t.code&&"string"==typeof t.message))return e.response.data.error;var t},t.getMessage=function(e){var t=e&&e.code||"0",n={0:i._("An error occurred, please try again later.")};return n[t]||n[0]},t}(Error);t.ManagementAPIError=a},function(e,t,n){"use strict";var r,o=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),i=this&&this.__assign||function(){return(i=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},a=this&&this.__spreadArrays||function(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;var r=Array(e),o=0;for(t=0;t<n;t++)for(var i=arguments[t],a=0,s=i.length;a<s;a++,o++)r[o]=i[a];return r};Object.defineProperty(t,"__esModule",{value:!0}),t.ConfigurationForm=void 0;var s,c=n(0),l=n(0),u=n(2),p=n(3),d=n(9),f=n(5),h=n(6),m=n(1),g=n(11),b=n(15),v=n(4),y=n(13),_=n(12),P=n(18),w=n(10),E=n(14);!function(e){e[e.AMP=0]="AMP",e[e.USER_SEGMENTATION=1]="USER_SEGMENTATION",e[e.WOOCOMMERCE=2]="WOOCOMMERCE",e[e.PROMPTS=3]="PROMPTS",e[e.NOTIFICATIONS=4]="NOTIFICATIONS",e[e.BASIC=5]="BASIC",e[e.UTMPARAMS=6]="UTMPARAMS",e[e.ADVANCED=7]="ADVANCED"}(s||(s={}));var C=function(e){switch(e){case s.AMP:return m._("AMP");case s.USER_SEGMENTATION:return m._("Segmentation");case s.WOOCOMMERCE:return m._("WooCommerce");case s.PROMPTS:return m._("Prompts");case s.NOTIFICATIONS:return m._("Blogging");case s.BASIC:return m._("Basic settings");case s.UTMPARAMS:return m._("UTM params");case s.ADVANCED:return m._("Advanced")}},k=function(e){function t(t){var n,r,o=e.call(this,t)||this;return o.state={workingConfiguration:t.configuration?o.cloneConfiguration(t.configuration):new g.WordPressWonderPushConfiguration,currentTab:s.BASIC},E.getConfig().then(function(e){return o.setState({wooCommerceInstalled:e.wooCommerce,ampInstalled:e.amp})}),t.configuration||t.fetchingConfiguration||t.fetchConfiguration(),t.configuration&&t.configuration.applicationId&&t.configuration.accessToken&&!t.application&&!t.fetchingApplication&&t.fetchApplication({accessToken:t.configuration.accessToken,applicationId:t.configuration.applicationId}),(null===(n=t.configuration)||void 0===n?void 0:n.applicationId)&&(null===(r=t.configuration)||void 0===r?void 0:r.accessToken)&&!t.segments&&!t.fetchingSegments&&t.fetchSegments({accessToken:t.configuration.accessToken,applicationId:t.configuration.applicationId}),P.getPrefillQueryParams().then(function(e){o.setState({prefillQueryString:h.stringify(e)})}),o}return o(t,e),t.prototype.cloneConfiguration=function(e,t){return void 0===t&&(t=void 0),_.plainToClass(g.WordPressWonderPushConfiguration,i(i({},JSON.parse(JSON.stringify(e))),t||{}))},t.prototype.componentDidUpdate=function(e,t){var n=this;if(this.props.configuration&&this.props.configuration.applicationId!==(e.configuration&&e.configuration.applicationId||void 0))this.setState({workingConfiguration:this.cloneConfiguration(this.props.configuration)});else if(this.props.configuration&&this.props.updateConfigurationFailure&&this.props.updateConfigurationFailure!==e.updateConfigurationFailure)this.setState({workingConfiguration:this.cloneConfiguration(this.props.configuration)});else{if(this.props.configuration&&this.props.updateConfigurationSuccess&&this.props.updateConfigurationSuccess!==e.updateConfigurationSuccess)return this.setState({workingConfiguration:this.cloneConfiguration(this.props.configuration),changesSaved:!0}),void setTimeout(function(){return n.setState({changesSaved:!1})},2e3);(this.state.workingConfiguration.enableOrderCompleteNotifications&&!t.workingConfiguration.enableOrderCompleteNotifications||this.state.workingConfiguration.enableOrderProcessingNotifications&&!t.workingConfiguration.enableOrderProcessingNotifications)&&this.state.workingConfiguration.disableUserIdInSnippet&&this.setState({workingConfiguration:this.cloneConfiguration(this.state.workingConfiguration,{disableUserIdInSnippet:!1})}),this.state.workingConfiguration.disableUserIdInSnippet&&!t.workingConfiguration.disableUserIdInSnippet&&(this.state.workingConfiguration.enableOrderCompleteNotifications||this.state.workingConfiguration.enableOrderProcessingNotifications)&&this.setState({workingConfiguration:this.cloneConfiguration(this.state.workingConfiguration,{enableOrderCompleteNotifications:!1,enableOrderProcessingNotifications:!1})})}},t.prototype.save=function(){this.props.updateConfiguration(this.state.workingConfiguration)},t.prototype.renderError=function(){var e=this.props.updateConfigurationFailure;return e?l.createElement("div",{className:"error"},e.message):null},t.prototype.renderCheckbox=function(e,t){var n=this;return l.createElement("div",{className:"row checkbox"},l.createElement("div",{className:"col"},l.createElement("div",{className:"custom-control custom-switch"},l.createElement("input",{type:"checkbox",checked:t.invert?!this.state.workingConfiguration[e]:!!this.state.workingConfiguration[e],disabled:!!this.props.updatingConfiguration,className:"custom-control-input",onChange:function(r){var o;n.setState({workingConfiguration:n.cloneConfiguration(n.state.workingConfiguration,(o={},o[e]=t.invert?!r.target.checked:!!r.target.checked,o))})},id:e}),l.createElement("label",{className:"custom-control-label",htmlFor:e},t.label))),l.createElement("div",{className:"col help"},l.createElement("p",null,t.helpText)))},t.prototype.renderTextField=function(e,t){var n=this;return l.createElement("div",{className:"row textfield"+((null==t?void 0:t.subsetting)?" subsetting":"")},l.createElement("div",{className:"col"},l.createElement("div",{className:"form-group"},l.createElement("label",{htmlFor:e+"Field"},t.label),l.createElement("input",{type:"text",value:this.state.workingConfiguration[e]||"",onChange:function(r){var o,i=r.target.value||"";n.setState({workingConfiguration:n.cloneConfiguration(n.state.workingConfiguration,(o={},o[e]=t.filter?t.filter(i):i,o))})},className:"form-control",id:e+"Field","aria-describedby":e+"Help",placeholder:t.placeholder}))),l.createElement("div",{className:"col help"},l.createElement("p",{id:e+"Help"},t.helpText)))},t.prototype.renderTextarea=function(e,t){var n=this;return l.createElement("div",{className:"row textarea"},l.createElement("div",{className:"col"},l.createElement("div",{className:"form-group"},l.createElement("label",{htmlFor:e+"Field"},t.label),l.createElement("textarea",{onChange:function(r){var o,i=r.target.value||"";n.setState({workingConfiguration:n.cloneConfiguration(n.state.workingConfiguration,(o={},o[e]=t.filter?t.filter(i):i,o))})},value:this.state.workingConfiguration[e]||"",className:"form-control",id:e+"Field","aria-describedby":e+"Help",placeholder:t.placeholder}))),l.createElement("div",{className:"col help"},l.createElement("p",{id:e+"Help"},t.helpText)))},t.prototype.renderSelect=function(e,t,n){var r=this;return l.createElement("div",{className:"row select"},l.createElement("div",{className:"col"},l.createElement("div",{className:"form-group"},l.createElement("label",{htmlFor:e+"Field"},n.label),l.createElement("select",{value:this.state.workingConfiguration[e]||"",onChange:function(t){var n;r.setState({workingConfiguration:r.cloneConfiguration(r.state.workingConfiguration,(n={},n[e]=t.target.value||"",n))})},className:"form-control",id:e+"Field","aria-describedby":e+"Help"},t.map(function(e){return l.createElement("option",{value:e.value},e.label||e.value)})))),l.createElement("div",{className:"col help"},l.createElement("p",{id:e+"Help"},n.helpText)))},t.prototype.renderMissingConfiguration=function(){var e=this.props.application;if(!e)return null;var t=this.state.prefillQueryString;return l.createElement("div",{className:"configuration-needed"},l.createElement("div",{className:"row"},l.createElement("div",{className:"col configure"},l.createElement("h2",null,m._("WonderPush needs a bit of configuration!")),l.createElement("p",null,l.createElement("a",{target:"_blank",className:"button button-primary",href:w.Constants.DASHBOARD_URL+"applications/"+encodeURIComponent(e.id)+"/web-settings?"+t+"&utm_source=WordPressPlugin&utm_content=configure"},m._("Configure your project")," ",l.createElement("span",{className:"dashicons dashicons-external"}))))),l.createElement("div",{className:"row"},l.createElement("div",{className:"col access-token"},l.createElement("strong",null,m._("Access token")),l.createElement(b.AccessTokenForm,null))))},t.prototype.renderAmp=function(){var e=this.state,t=e.ampInstalled,n=e.workingConfiguration;if(!t)return null;var r=function(e){return e.replace(/[^0-9]*/g,"")};return l.createElement("div",null,l.createElement("h2",null,C(s.AMP)),l.createElement("h5",null,m._("Subscribe button")),l.createElement("div",{className:"settings"},n.disableAmpTopSubscribeButton&&n.disableAmpBottomSubscribeButton?l.createElement("div",{className:"alert alert-warning"},m._("Disabling both top and bottom subscription buttons completely disables subscription on AMP pages")):null,this.renderCheckbox("disableAmpTopSubscribeButton",{invert:!0,label:m._("Display subscribe button at the top of AMP pages"),helpText:m._("Disable this option to remove the subscription button at the top of AMP pages and posts.")}),this.renderCheckbox("disableAmpBottomSubscribeButton",{invert:!0,label:m._("Display subscribe button at the bottom of AMP pages"),helpText:m._("Disable this option to remove the subscription button at the bottom of AMP pages and posts.")}),this.renderTextField("ampSubscribeButtonLabel",{label:m._("Subscribe button label"),placeholder:m._("Subscribe to news updates"),helpText:m._("The label of the subscription button on AMP pages.")})),l.createElement("h5",null,m._("Unsubscribe button")),l.createElement("div",{className:"settings"},this.renderCheckbox("disableAmpUnsubscribe",{invert:!0,label:m._("Display unsubscribe button to subscribed users on AMP pages"),helpText:m._("Disable this option to remove the option to unsubscribe to subscribed AMP users.")}),n.disableAmpUnsubscribe?null:this.renderTextField("ampUnsubscribeButtonLabel",{label:m._("Unsubscribe button label"),placeholder:m._("Unsubscribe from news updates"),helpText:m._("The label of the unsubscription button on AMP pages.")})),l.createElement("h5",null,m._("Look and feel")),l.createElement("div",{className:"settings"},this.renderTextField("ampButtonWidth",{label:m._("Button width"),placeholder:m._("250"),filter:r,helpText:m._("The width in pixels of both subscribe and unsubscribe buttons.")}),this.renderTextField("ampButtonHeight",{label:m._("Button height"),placeholder:m._("80"),filter:r,helpText:m._("The height in pixels of both subscribe and unsubscribe buttons.")})))},t.prototype.renderSegmentation=function(){return l.createElement("div",null,l.createElement("h2",null,C(s.USER_SEGMENTATION)),l.createElement("div",{className:"settings"},this.renderCheckbox("disableUserIdInSnippet",{invert:!0,label:m._("Send user IDs of subscribers to WonderPush."),helpText:m._("If checked, WonderPush will receive the user ID of logged-in users that subscribe to push notifications. This allows you to target push notification recipients by their WordPress user ID.")}),!this.state.workingConfiguration.disableUserIdInSnippet&&this.renderCheckbox("emailAsUserId",{label:m._("Set the user's email address as WonderPush user ID."),helpText:m._("If checked, WonderPush will receive the email of the user as user ID. This makes it easier to match push subscribers with email based CRM systems like Brevo.")}),this.renderCheckbox("enableUserSegmentation",{invert:!1,label:m._("Collect subscribed users personal information"),helpText:l.createElement("span",{dangerouslySetInnerHTML:{__html:y.sprintf(m._("When active, WonderPush will automatically set %s properties when users are both subscribed and logged-in. These %sProperties%s that can be used for %sSegmentation%s and %sPersonalized content%s."),["string_first_name","string_last_name","string_user_login","string_display_name"].map(function(e){return"<code>"+e+"</code>"}).join(", "),'<a target="_blank" href="https://docs.wonderpush.com/docs/properties">',"</a>",'<a target="_blank" href="https://docs.wonderpush.com/docs/segmentation-overview">',"</a>",'<a target="_blank" href="https://docs.wonderpush.com/docs/personalized-content">',"</a>")}})})))},t.prototype.renderWooCommerce=function(){var e=this.state,t=e.wooCommerceInstalled,n=e.workingConfiguration;if(!t)return null;var r=this.props.application;return r?l.createElement("div",null,l.createElement("h2",null,C(s.WOOCOMMERCE)),l.createElement("div",{className:"settings"},this.renderCheckbox("enableCartReminder",{invert:!1,label:m._("Cart reminder: automatically send a notification after some time when users leave without buying."),helpText:m._("If checked, users that leave without buying and have a non-empty cart will receive a notification after some time. This amount of time can be configured from your WonderPush dashboard by editing the targeting of the “Cart Reminder” notification found under “Notifications”.")}),n.enableCartReminder?l.createElement("div",null,this.renderSelect("cartReminderStrategy",[{value:"latest",label:m._("last product added")},{value:"most-expensive",label:m._("most expensive product in cart")},{value:"least-expensive",label:m._("least expensive product in cart")}],{label:m._("Cart reminder notification title:"),helpText:m._("When we send a cart reminder notification, its title is based on a product in the cart. This preference determines how this product is chosen if the cart contains more than one product.")}),this.renderSelect("cartReminderDestination",[{value:"homepage",label:m._("homepage")},{value:"cart",label:m._("cart")},{value:"checkout",label:m._("checkout")}],{label:m._("Cart reminder notification destination:"),helpText:m._("Where we send the user upon cart reminder notification click.")}),this.renderTextField("cartReminderMessage",{label:m._("Cart reminder message"),placeholder:m._("Order before it's too late!"),helpText:l.createElement("span",null,m._("The text of the notification we send users to remind them of their cart.")," ",l.createElement("strong",null,m._("Liquid syntax is not supported in that field."))," ",l.createElement("span",{dangerouslySetInnerHTML:{__html:y.sprintf(m._("Modify the %s if you wish to use liquid syntax."),'<a href="'+r.dashboardCampaignsUrl.href+'" target="_blank">'+m._("Cart Reminder notification text from your dashboard")+"</a>")}})," ",m._("Defaults to “Order before it's too late!”."))}),this.renderCheckbox("disableCartReminderImage",{invert:!0,label:m._("Include the product image in the cart reminder notification"),helpText:m._("If checked, use the product's main image in the notification sent to users who leave without buying the contents of their cart.")})):null,this.renderCheckbox("enableOrderCompleteNotifications",{invert:!1,label:m._("Order complete notifications."),helpText:m._("If checked, automatically send a notification to customers when their order status changes from “Processing” to “Complete”. Requires “Send user IDs of subscribers to WonderPush”. Only customers that have an account with your shop (e.g. not guests) will receive a notification.")}),n.enableOrderCompleteNotifications?l.createElement("div",null,this.renderTextField("orderCompleteNotificationsMessage",{label:m._("Order complete message"),placeholder:m._("We've just shipped your order."),helpText:m._("The text of the notification we send users when their order status changes from “Processing” to “Complete”. Defaults to “We've just shipped your order.”.")})):null,this.renderCheckbox("enableOrderProcessingNotifications",{invert:!1,label:m._("Order processing notifications."),helpText:m._("If checked, automatically send a notification to customers when their order status changes from “Pending” to “Processing” (or “Complete” for digital goods). Requires “Send user IDs of subscribers to WonderPush”. Only customers that have an account with your shop (e.g. not guests) will receive a notification.")}),n.enableOrderProcessingNotifications?l.createElement("div",null,this.renderTextField("orderProcessingNotificationsMessage",{label:m._("Order processing message"),placeholder:m._("We're preparing your order."),helpText:m._("The text of the notification we send users when their order status changes from “Pending” to “Processing” (or “Complete” for digital goods). Defaults to “We're preparing your order.”.")})):null,this.renderCheckbox("disableThankYouEvent",{invert:!0,label:m._("Send a WonderPush event when users make a purchase."),helpText:m._("If checked, send a WonderPush event when users reach the thank-you page of the ordering process.")}),n.disableThankYouEvent?null:l.createElement("div",null,this.renderTextField("thankYouEventName",{label:m._("Name of the event sent when users reach the thank-you page"),placeholder:m._("GOAL_1"),helpText:m._("The name of the WonderPush event sent to our servers when users reach the thank-you page. Use that event name to create segments and target users who have already made a purchase.")})))):null},t.prototype.renderAccessTokenBlurb=function(){var e=this,t=this.props.configuration;if(!t)return null;var n=t.accessToken;if(!n)return null;return l.createElement("p",null,m._("Your access token:")," ",l.createElement("code",{title:n},n.substring(0,Math.min(24,n.length)),n.length>24?"…":null)," ",l.createElement("a",{href:"#",onClick:function(t){t&&t.preventDefault(),e.props.updatingAccessToken||confirm("Are you sure? You will loose any setting you've customized.")&&e.props.removeAccessToken()}},m._("remove")),this.props.updatingAccessToken?l.createElement("span",{className:"dashicons dashicons-update spin"}):null)},t.prototype.renderSubscriptionUI=function(){var e=this.props,t=e.application,n=e.configuration;if(!t||!n)return null;var r=!n.disableSnippet,o=t.webSdkInitOptions;if(!o)return null;var i=[];o.isPromptTypeActive("bell")&&i.push(l.createElement("span",{key:"bell"},"the ",l.createElement("strong",null,"subscription bell"))),o.isPromptTypeActive("dialog")&&i.push(l.createElement("span",{key:"html"},"the ",l.createElement("strong",null,"HTML dialog"))),o.isPromptTypeActive("native")&&i.push(l.createElement("span",{key:"native"},"the ",l.createElement("strong",null,"native prompt")));var a=function(e){return e===i.length-1?" and ":", "},c=l.createElement("span",null,i[0],i[1]?[a(1),i[1]]:null,i[2]?[a(2),i[2]]:null);return l.createElement("div",null,l.createElement("h2",null,C(s.PROMPTS)),l.createElement("div",{className:"settings"},this.renderCheckbox("disableSnippet",{invert:!0,label:m._("Enable WonderPush and prompt users to subscribe to push notifications"),helpText:l.createElement("div",null,l.createElement("p",null,m._("Disable this option to remove WonderPush from this site. Users won't be able to subscribe anymore, but you'll still be able to reach your existing subscribers.")),i.length?l.createElement("p",null,r?l.createElement("span",null,"Users can subscribe using ",c,"."):l.createElement("span",null,l.createElement("span",{className:"text-warning"},"WonderPush is currently disabled.")," ",l.createElement("span",{className:"text-muted"},"Once WonderPush is enabled, your site will show ",c,"."))," ",l.createElement("a",{href:t.dashboardWebSettingsUrl.href,target:"_blank"},m._("Configure"))):r?"Users can not currently subscribe, no subscription prompt is configured.":"No subscription prompt configured.")})))},t.prototype.renderNotificationSettings=function(){var e=a([{id:"",name:"Everybody"}],(this.props.segments||[]).filter(function(e){return!!e.name})),t=[5,10,15,20,25,30,35,40,45,50,55].map(function(e){return{value:""+60*e,label:e.toLocaleString(void 0,{maximumFractionDigits:0})+" "+m._("minutes")}}),n=[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24].map(function(e){return{value:""+3600*e,label:e.toLocaleString(void 0,{maximumFractionDigits:0})+" "+m._("hours")}}),r=a(t,n);return l.createElement("div",null,l.createElement("h2",null,C(s.NOTIFICATIONS)),l.createElement("div",{className:"settings"},this.renderError(),this.renderCheckbox("disableSendByDefaultOnPublish",{invert:!0,label:m._("Automatically send a notification when I publish a post from the WordPress editor."),helpText:m._("If checked, when you create a new post from WordPress's editor, the checkbox 'Send notification on post publish/update' will be automatically checked. The checkbox can be unchecked to prevent sending a notification.")}),this.renderCheckbox("sendOnThirdPartyPublish",{invert:!1,label:m._("Automatically send a notification when I publish a post from a 3rd party plugin."),helpText:m._("If checked, when a post is created outside of WordPress's editor, a push notification will automatically be sent. Must be the built-in WordPress post type 'post' and the post must be published.")}),this.state.workingConfiguration.sendOnThirdPartyPublish?this.renderTextField("additionalCustomPostTypes",{label:m._("Additional Custom Post Types for Automatic Notifications Created From Plugins"),helpText:m._("Enter a comma-separated list of custom post type names. Anytime a post is published with one of the listed post types, a notification will be sent to all your users."),subsetting:!0}):null,this.renderTextField("notificationTitle",{label:m._("Notification title"),helpText:m._("The notification title to use for all outgoing notifications. Defaults to your site's title.")}),this.renderSelect("defaultTargetSegmentId",e.map(function(e){return{value:e.id,label:e.name}}),{label:m._("Default target segment title:"),helpText:m._("The default segment to use for new blog post notifications. You can override this setting for each post in the WordPress editor.")}),this.renderSelect("deliveryTimeSeconds",a([{value:"0",label:m._("No delay")}],r),{label:m._("Push notification delay:"),helpText:m._("Add a delay before sending blog post notifications. The notification is sent to WonderPush immediately and cannot be cancelled, but its delivery is delayed according to this setting.")}),this.renderCheckbox("disableUsePostImageForNotification",{invert:!0,label:m._("Use the post featured image as notification image"),helpText:m._("If checked, use the post's featured image in the notification.")}),this.state.workingConfiguration.disableUsePostImageForNotification?null:this.renderCheckbox("preferLargeImageForNotification",{invert:!1,label:m._("Prefer large notification image"),helpText:m._("If checked, use a larger image in the notification. May affect your site performance.")}),this.renderCheckbox("disableSendOnPublish",{invert:!0,label:m._("Display 'Send notification on post publish' in the WordPress editor."),helpText:m._("If checked, WonderPush will add the option to send a notification directly from the WordPress Editor.")}),this.renderCheckbox("disableFeedbackOnPublish",{invert:!0,label:m._("Display number of subscribers when I publish a post."),helpText:m._("If checked, WonderPush will display the number of subscribers reached when you checked 'Send notification on post publish/update' and published a post from the WordPress Editor.")})))},t.prototype.renderBasicSettings=function(){var e=this.props,t=(e.configuration,e.application);return t?l.createElement("div",null,l.createElement("h2",null,C(s.BASIC)),l.createElement("div",{className:"row"},l.createElement("div",{className:"col"},this.renderAccessTokenBlurb()),l.createElement("div",{className:"col"},l.createElement("p",null,l.createElement("strong",null,m._("Congratulations, WonderPush is installed!"))," ",l.createElement("span",{dangerouslySetInnerHTML:{__html:y.sprintf(m._("This access token corresponds to the project named %s with identifier %s."),'<a href="'+w.Constants.DASHBOARD_URL+"applications/"+t.id+'/overview?utm_source=WordPressPlugin&utm_content=configure2" target="_blank">'+t.name+"</a>","<code>"+t.id+"</code>")}}))))):null},t.prototype.renderAdvancedSettings=function(){return l.createElement("div",null,l.createElement("h2",null,C(s.ADVANCED)),l.createElement("div",{className:"settings"},this.renderTextarea("additionalInitOptionsJson",{label:m._("Additional init options JSON"),placeholder:m._("{ ... }"),helpText:l.createElement("span",null,m._("A valid JSON object to be merged with")," ",l.createElement("a",{href:"https://docs.wonderpush.com/docs/website-sdk-reference#section-init"},m._("WonderPush init options")),"."," ",m._("Use with care as this can damage your WonderPush installation."))}),this.renderCheckbox("bypassWordPressHttpClient",{invert:!0,label:m._("Use the WordPress built-in HTTP API"),helpText:m._("When checked, WonderPush will contact its own API using the HTTP client built in WordPress. When checked, hooks like http_api_curl will allow other plugins to customize HTTP calls. Uncheck if you want WonderPush to use an HTTP client that cannot be affected by other plugins.")})))},t.prototype.renderGoogleCampaignParameterSettings=function(){return l.createElement("div",null,l.createElement("h2",null,C(s.UTMPARAMS)),l.createElement("div",{className:"settings"},this.renderTextField("utmSource",{label:m._("Source"),placeholder:m._("mywebsite.com"),helpText:l.createElement("span",null,m._("The default value of the utm_source parameter. Identifies the advertiser, site, publication, etc. Can be overridden for each post.")," ",l.createElement("a",{href:"https://support.google.com/analytics/answer/1033863#parameters",target:"_blank"},m._("Reference")),".")}),this.renderTextField("utmMedium",{label:m._("Medium"),placeholder:m._("push"),helpText:l.createElement("span",null,m._("The default value of the utm_medium parameter. The advertising or marketing medium. Can be overridden for each post.")," ",l.createElement("a",{href:"https://support.google.com/analytics/answer/1033863#parameters",target:"_blank"},m._("Reference")),".")}),this.renderTextField("utmCampaign",{label:m._("Campaign"),placeholder:m._(""),helpText:l.createElement("span",null,m._("The default value of the utm_campaign parameter. The individual campaign name, slogan, promo code, etc. Can be overridden for each post.")," ",l.createElement("a",{href:"https://support.google.com/analytics/answer/1033863#parameters",target:"_blank"},m._("Reference")),".")}),this.renderTextField("utmTerm",{label:m._("Term"),placeholder:m._(""),helpText:l.createElement("span",null,m._("The default value of the utm_term parameter. Identify paid search keywords. Can be overridden for each post.")," ",l.createElement("a",{href:"https://support.google.com/analytics/answer/1033863#parameters",target:"_blank"},m._("Reference")),".")}),this.renderTextField("utmContent",{label:m._("Content"),placeholder:m._(""),helpText:l.createElement("span",null,m._("The default value of the utm_content parameter. Used to differentiate similar content, or links within the same ad. Can be overridden for each post.")," ",l.createElement("a",{href:"https://support.google.com/analytics/answer/1033863#parameters",target:"_blank"},m._("Reference")),".")})))},t.prototype.render=function(){var e,t=this,n=this.props,r=n.configuration,o=n.application,i=this.state,a=i.changesSaved,c=i.currentTab,u=i.wooCommerceInstalled,p=i.ampInstalled,d=i.showNav;if(!r||!o)return null;if(!o.webPlatformConfigured)return this.renderMissingConfiguration();var f=[s.BASIC,s.NOTIFICATIONS,s.PROMPTS,s.USER_SEGMENTATION,u?s.WOOCOMMERCE:null,p?s.AMP:null,s.UTMPARAMS,s.ADVANCED].filter(function(e){return null!==e}),h=((e={})[s.BASIC]=function(){return t.renderBasicSettings()},e[s.NOTIFICATIONS]=function(){return t.renderNotificationSettings()},e[s.PROMPTS]=function(){return t.renderSubscriptionUI()},e[s.USER_SEGMENTATION]=function(){return t.renderSegmentation()},e[s.WOOCOMMERCE]=function(){return t.renderWooCommerce()},e[s.AMP]=function(){return t.renderAmp()},e[s.UTMPARAMS]=function(){return t.renderGoogleCampaignParameterSettings()},e[s.ADVANCED]=function(){return t.renderAdvancedSettings()},e),g=function(e){return function(n){n.preventDefault(),t.setState({currentTab:e,showNav:!1})}};return l.createElement("div",{className:"configuration-form box p-0"},l.createElement("nav",{className:"navbar navbar-expand-lg navbar-light bg-light",style:{fontSize:"1.15em"}},l.createElement("button",{onClick:function(){return t.setState({showNav:!d})},className:"navbar-toggler",type:"button","data-toggle":"collapse","data-target":"#navbarSupportedContent","aria-controls":"navbarSupportedContent","aria-expanded":"false","aria-label":"Toggle navigation"},l.createElement("span",{className:"navbar-toggler-icon"})),l.createElement("div",{className:"collapse navbar-collapse "+(d?"show":""),id:"navbarSupportedContent"},l.createElement("ul",{className:"navbar-nav"},f.map(function(e){return l.createElement("li",{className:"nav-item "+(e===c?"active":"")},l.createElement("a",{className:"nav-link",href:"#",onClick:g(e)},C(e)))})))),this.renderError(),l.createElement("div",{className:"p-4"},h[c](),l.createElement("button",{style:{verticalAlign:"baseline"},className:"button button-primary",onClick:function(){return t.save()}},this.props.updatingConfiguration?l.createElement("span",{className:"dashicons dashicons-update spin"}):null,m._("Save")),a?l.createElement("span",{className:"text-muted"}," ",m._("Changes saved")):null))},t}(c.Component);t.ConfigurationForm=u.connect(function(e,t){var n=d.stateHelper(e.wordPressAPI),r=f.stateHelper(e.managementAPI),o=e.wordPressAPI.configuration?e.wordPressAPI.configuration.applicationId:null;return{configuration:e.wordPressAPI.configuration,segments:o?r.segment.listByApplicationId(o):void 0,fetchingConfiguration:n.network.latest.loading(p.actions.getConfiguration.request),application:o?r.application.getById(o):void 0,fetchingApplication:r.network.latest.loading(v.actions.getApplicationById.request),updatingConfiguration:n.network.latest.loading(p.actions.updateConfiguration.request),updateConfigurationFailure:n.network.latest.failure(p.actions.updateConfiguration.request),updateConfigurationSuccess:n.network.latest.success(p.actions.updateConfiguration.request),updatingAccessToken:n.network.latest.loading(p.actions.setAccessToken.request),updateAccessTokenSuccess:n.network.latest.success(p.actions.setAccessToken.request),updateAccessTokenFailure:n.network.latest.failure(p.actions.setAccessToken.request)}},function(e,t){return{fetchConfiguration:function(){return e(p.actions.getConfiguration.request({}))},fetchSegments:function(t){return e(v.actions.getSegmentList.request(t))},updateConfiguration:function(t){return e(p.actions.updateConfiguration.request(t))},fetchApplication:function(t){return e(v.actions.getApplicationById.request(t))},removeAccessToken:function(){return e(p.actions.setAccessToken.request({accessToken:"0"}))}}})(k)},function(e,t,n){"use strict";var r,o=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),a=n(2),s=n(5),c=function(e){function t(t){var n=e.call(this,t)||this;return n.state={},n}return o(t,e),t.prototype.render=function(){var e=this.props.application;return e&&e.trialEndDate?e.trialEndDate-+new Date<=0?i.createElement("div",{className:"alert alert-danger"},i.createElement("h4",{className:"alert-heading"},"Trial ended"),i.createElement("p",null,"Your 14-day free trial ended on ",new Intl.DateTimeFormat(void 0,{dateStyle:"long",timeStyle:"short"}).format(e.trialEndDate),"."," ",i.createElement("button",{className:"button button-primary",onClick:function(){window.location=e.dashboardUrl.href}},"Enter your payment information"))):i.createElement("div",{className:"alert alert-warning"},i.createElement("h4",{className:"alert-heading"},"Ongoing trial"),i.createElement("p",null,"Your 14-day free trial will end on ",new Intl.DateTimeFormat(void 0,{dateStyle:"long",timeStyle:"short"}).format(e.trialEndDate),"."," ",i.createElement("a",{className:"alert-link",href:e.dashboardUrl.href,target:"_blank"},"Enter your payment information"),".")):null},t}(i.Component);t.default=a.connect(function(e,t){var n=s.stateHelper(e.managementAPI);return{application:e.wordPressAPI.configuration&&e.wordPressAPI.configuration.applicationId?n.application.getById(e.wordPressAPI.configuration.applicationId):void 0}})(c)},function(e,t,n){"use strict";var r,o=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),a=n(2),s=n(1),c=n(4),l=n(5),u=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={},t}return o(t,e),t.prototype.componentDidMount=function(){this.loadBasicStatsIfNeeded()},t.prototype.componentDidUpdate=function(e,t,n){this.loadBasicStatsIfNeeded()},t.prototype.loadBasicStatsIfNeeded=function(){this.props.basicStats||this.props.loading.basicStats||this.props.getBasicStats(this.props.accessToken)},t.prototype.renderNumber=function(e,t){return i.createElement("div",{className:"metric"},i.createElement("span",{className:"legend"},t),i.createElement("span",{className:"number"},e.toLocaleString(void 0,{maximumFractionDigits:0})))},t.prototype.render=function(){var e=this.props,t=e.basicStats,n=e.application,r=e.wonderPushActive;if(!t||!r)return null;var o=i.createElement("p",null,s._("Get more performance metrics from")," ",i.createElement("a",{target:"_blank",href:n.dashboardUrl.href},s._("your WonderPush dashboard")),".");return i.createElement("div",{className:"box mb-2"},i.createElement("h2",null,s._("Performance")),i.createElement("div",{className:"row"},i.createElement("div",{className:"col-lg"},this.renderNumber(n.subscribers||0,s._("Subscribers")),this.renderNumber(t.totalSent(),s._("Pushes (Last 30 days)")),this.renderNumber(t.totalOpened(),s._("Clicks (Last 30 days)"))),i.createElement("div",{className:"col-lg help"},o)))},t}(i.Component);t.default=a.connect(function(e,t){var n=l.stateHelper(e.managementAPI),r={accessToken:t.accessToken,platforms:"@ALL",resolution:"day",interval:30};return{basicStats:n.stats(r),wonderPushActive:e.wordPressAPI.configuration&&!e.wordPressAPI.configuration.disableSnippet,loading:{basicStats:n.network.latest.loading(c.actions.getStats.request)}}},function(e,t){return{getBasicStats:function(){return e(c.actions.getStats.request({accessToken:t.accessToken,platforms:"@ALL",resolution:"day",interval:30}))}}})(u)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(34);Object.defineProperty(t,"store",{enumerable:!0,get:function(){return r.default}})},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.epicMiddleware=void 0;var r=n(19),o=n(35),i=n(8),a=n(36),s=n(8),c=n(20),l=n(21);n(1);var u=s.combineEpics(c.wordPressAPIEpics,l.managementAPIEpics),p=r.compose;t.epicMiddleware=i.createEpicMiddleware({dependencies:a});var d,f,h,m=(f=[t.epicMiddleware],h=p(r.applyMiddleware.apply(void 0,f)),r.createStore(o.rootReducer,d,h));t.epicMiddleware.run(u),t.default=m},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.rootReducer=void 0;var r=n(19),o=n(20),i=n(21);t.rootReducer=r.combineReducers({wordPressAPI:o.wordPressAPIReducer,managementAPI:i.managementAPIReducer})},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.managementAPIClient=t.wordPressAPIClient=void 0;var r=n(37);Object.defineProperty(t,"wordPressAPIClient",{enumerable:!0,get:function(){return r.default}});var o=n(38);Object.defineProperty(t,"managementAPIClient",{enumerable:!0,get:function(){return o.default}})},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(22),o=n(6),i=n(14),a=n(12),s=n(11),c=new(function(){function e(){}return e.prototype.payload=function(e,t){return i.getConfig().then(function(n){return o.stringify(t)+"&nonce="+encodeURIComponent(n.nonce)+"&action="+encodeURIComponent(e)})},e.prototype.get=function(e,t){return void 0===t&&(t={}),Promise.all([i.getConfig(),this.payload(e,t)]).then(function(e){var t=e[0],n=e[1];return r.default.get(t.ajaxUrl+"?"+n)})},e.prototype.post=function(e,t){return Promise.all([i.getConfig(),this.payload(e,t)]).then(function(e){var t=e[0],n=e[1];return r.default.post(t.ajaxUrl,n)})},e.prototype.getConfiguration=function(){return this.get("wonderpush_get_configuration").then(function(e){return a.plainToClass(s.WordPressWonderPushConfiguration,e.data)})},e.prototype.setAccessToken=function(e){return this.post("wonderpush_set_access_token",e).then(function(e){return a.plainToClass(s.WordPressWonderPushConfiguration,e.data)})},e.prototype.updateConfiguration=function(e){return this.post("wonderpush_update_configuration",e).then(function(e){return a.plainToClass(s.WordPressWonderPushConfiguration,e.data)})},e}());t.default=c},function(e,t,n){"use strict";var r=this&&this.__assign||function(){return(r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0}),t.ApiClient=void 0;var o=n(22),i=n(11),a=n(6),s=n(12),c=n(10),l=function(){function e(){this.axiosInstances={}}return e.prototype.axios=function(e){return this.axiosInstances[e]||(this.axiosInstances[e]=o.default.create({headers:{"Content-Type":"application/json"},baseURL:c.Constants.MANAGEMENT_API_URL,withCredentials:!0,params:{accessToken:e},paramsSerializer:function(e){return a.stringify(e,{arrayFormat:"repeat"})}})),this.axiosInstances[e]},e.prototype.request=function(e,t,n,o){var i=o||{};return i.params=i.params?r(r({},i.params),{accessToken:n}):{accessToken:n},i=r(r({},i),{method:e,url:t}),this.axios(n).request(i)},e.prototype.getApplicationById=function(e){return this.request("GET","applications/"+e.applicationId,e.accessToken).then(function(e){var t=e.data;return s.plainToClass(i.Application,t)})},e.prototype.getSegmentList=function(e){return this.request("GET","applications/"+e.applicationId+"/segments",e.accessToken).then(function(e){var t=e.data;return{size:t.count,list:t.data.map(function(e){return s.plainToClass(i.Segment,e)})}})},e.prototype.stats=function(e){return this.request("GET","stats/events",e.accessToken,{params:e}).then(function(e){var t=e.data;return s.plainToClass(i.StatsResponse,t)})},e}();t.ApiClient=l;var u=new l;t.default=u}]);